# Stock Price Prediction using CNN (PyTorch)

--------------------------------------------

## Project Description

<Blockquote>

This project implements a stock price prediction deep-learning model using a stock chart image.   
The model predicts whether the next-day close price of the input image (candle chart) will increase or not.   
Follow the below instructions to run a project.

**_[Anaconda](https://www.anaconda.com/products/distribution#Downloads) is REQUIRED to run .sh files._**

</Blockquote>

## Development Environment

<Blockquote>

- Python Version: 3.10.4
- PyTorch Version: 1.11.0
- Aanaconda Version: 4.13.0
- CUDA version: 11.4

</Blockquote>

## Initial Build

<Blockquote>

### Create New Conda Env.

```shell
$ conda create -n stockPrediction python=3.10
$ conda activate stockPrediction
```

### Install Requirements

```shell
$ conda install -c conda-forge --yes --file requirements.txt 
# Pytorch-CPU
$ conda install pytorch torchvision torchaudio cpuonly -c pytorch
# Pytorch-GPU
$ conda install pytorch torchvision torchaudio cudatoolkit=11.3 -c pytorch
```

### Test Build

```shell
$ conda activate stockPrediction
$ export PYTHONPATH=${PWD}
$ python3 src/stock_prediction/test.py
```

Following message should appear if you have followed the above instructions without errors.

```
Current Date: YYYY-MM-DD
Available Device for Model Training: YOUR_DEVICE (cuda:0 or cpu)
Initial Build done successfully!
```

</Blockquote>

## Run Preprocessor

<Blockquote>

If stock data (OHLC & Volume) is in the local data directory, the model generates input images using local stock
data.   
If not, the model loads top100 Kospi & Kosdaq stock data and generates input images using loaded stock data.

### Command Help

```shell
$ conda activate stockPrediction
$ export PYTHONPATH=${PWD}
$ python3 src/stock_prediction/main.py preprocess --help
```

</Blockquote>

## Run Trainer

<Blockquote>

Using images generated by preprocessor in a previous step, the model trains whether the
next-day price of input image will increase or not.

### Command Help

```shell
$ conda activate stockPrediction
$ export PYTHONPATH=${PWD}
$ python3 src/stock_prediction/main.py train --help
```

</Blockquote>

## Run Web App

<Blockquote>

### Run by Shell Script

Before running the .sh files, you must change the `user` and `project_path` in .sh files appropriately.   
If you're not sure what your username is, enter below command to see your username.

```shell
$ echo $USER
```

Then, by entering below commands, you can successfully run the flask app.

```shell
$ source scripts/get_app_data.sh
$ source scripts/app.sh
```

### Run by Terminal

However, there might be some issues with .sh files. If so, you can run web app through terminal as well.

```shell
$ conda activate stockPrediction
$ export PYTHONPATH=${PWD}
$ export FLASK_APP=src/stock_prediction/app/app.py
$ python3 src/stock_prediction/app/get_app_data.py
$ flask run
```

</Blockquote>

## Configurations

<Blockquote>

To modify the default configurations, go to `config/default_config.json`.

You can change the values in config file without any restrictions;
however, please be careful with an alternation of keys.    
When adding/deleting/altering the keys, you must make changes in `src/stock_prediction/config` as well.

</Blockquote>

## References

**[Using Deep Learning Neural Networks and Candlestick
Chart Representation to Predict Stock Market](https://arxiv.org/pdf/1903.12258v1.pdf)**
