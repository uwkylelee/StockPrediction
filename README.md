# Stock Price Prediction using CNN (PyTorch)

This project implements a stock price prediction deep-learning model using stock chart images.

## Introduction

The model predicts whether the future (1-5 days) close price of the stock will increase or not.

**_[Anaconda](https://www.anaconda.com/products/distribution#Downloads) is REQUIRED to run .sh files._**

**_Refer to [Pytorch Installation Guide](https://pytorch.org/get-started/locally/) to use GPU during training step._**

## Development Environment

- Python Version: 3.10.4
- PyTorch Version: 1.11.0
- CUDA version: 11.4

## Initial Build

### Create New Conda Env.

```shell
$ conda create -n stockPrediction python=3.10
$ conda activate stockPrediction
```

### Install Requirements

```shell
$ conda install -c conda-forge --yes --file requirements.txt 
# PyTorch-CPU
$ conda install pytorch torchvision torchaudio cpuonly -c pytorch
# PyTorch-GPU
$ conda install pytorch torchvision torchaudio cudatoolkit=11.3 -c pytorch
```

### Test Build

```shell
$ conda activate stockPrediction
$ export PYTHONPATH=${PWD}
$ python3 src/stock_prediction/test.py
```

Following messages will appear if you have followed the above instructions without any changes.

```
Current Date: YYYY-MM-DD
Available Device for Model Training: YOUR_DEVICE (cuda:0 or cpu)
Initial Build done successfully!
```

## Run Preprocessor

The model loads top100 KOSPI & KOSDAQ stock data and generates candle chart images.

### Command Help

```shell
$ conda activate stockPrediction
$ export PYTHONPATH=${PWD}
$ python3 src/stock_prediction/main.py preprocess --help
```

## Run Trainer

Using images generated by preprocessor in a previous step, the model trains whether the
next-day close price of input image will increase or not.

### Command Help

```shell
$ conda activate stockPrediction
$ export PYTHONPATH=${PWD}
$ python3 src/stock_prediction/main.py train --help
```

## Run Flask App

### Run by Shell Script

Before running the .sh files, you must change the `user` and `project_path` in .sh files appropriately.   
If you're not sure what your username is, enter below command to see your username.

```shell
$ echo $USER
```

Then, by entering the below commands, you can run the flask app.

```shell
$ source scripts/get_app_data.sh
$ source scripts/app.sh
```

### Run by Terminal

However, there might be some issues with .sh files. If so, you can run web app through terminal as well.

```shell
$ conda activate stockPrediction
$ export PYTHONPATH=${PWD}
$ export FLASK_APP=src/stock_prediction/app/app.py
$ python3 src/stock_prediction/app/get_app_data.py
$ flask run
```

## Configurations

To modify the default configurations, go to `config/default_config.json`.

You can freely change the values in config file;
however, please be careful with an alternation of keys.    
When adding/deleting/altering the keys, you must make changes in `src/stock_prediction/config` as well.

## References

[1] Rosdyana Mangir Irawan Kusuma & Trang-Thi Ho & Wei-Chun Kao & Yu-Yen Ou & Kai-Lung Hua, 2019.
**[Using Deep Learning Neural Networks and Candlestick
Chart Representation to Predict Stock Market](https://arxiv.org/pdf/1903.12258v1.pdf)**
